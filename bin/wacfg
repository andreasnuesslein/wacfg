#!/usr/bin/env python

import sys

from WaCfg.config import Config
from WaCfg.helpers import *
from WaCfg.vercmp import *
from WaCfg.output import OUT
from WaCfg.content import Content
from WaCfg.webapp import *

class Env:
    pass


def main():
    from WaCfg import optparsing
    from optparse import OptionParser, OptionGroup

    parser = optparsing.waopts()

    (Env.options, Env.args) = parser.parse_args()
    Env.cfg = Config()

    # end optparser ---------------------------------------------------

    OUT.debug("Eng.options: %s" % Env.options)
    OUT.debug("Env.args: %s" % Env.args)

    try:
        function = {'install': 'install',
         'upgrade': 'upgrade',
         'remove': 'remove',
         'purge': 'purge',
         }[Env.args[0]]
    except:
        parser.print_help()
        sys.exit(1)



    # Evaluate Options
    if Env.options.install:
        if len(Env.args) < 3:
            # XXX maybe just use the latest version here...
            return "Please specify a correct package and version"
        Application(Env.args[1], Env.args[2]).install()

    if Env.options.list:
        if len(Env.args) == 0:
            Env.args += [None]
        ApplicationList(Env.args[0]).list()


if __name__ == "__main__":
    sys.exit(main())

